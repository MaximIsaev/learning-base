# Postgres конспект

## Индексы

Это структура, которая строится на основе одного или нескольких значений 
конкретной таблицы и представляет собой отсортированную структуру(обычно B-tree).
В каждый элемент индекса помещается указатель на строку. При поиске, 
когда нужный элемент найден, СУБД переходит к строке по прямой ссылке из индекса

**Синтаксис** \
Создание -`CREATE INDEX имя-индекса ON имя-таблицы ( имя-столбца, ...);` \
Создание с указанием следования NULL значений - `CREATE INDEX имя-индекса ON имя-таблицы ( имя-столбца NULLS FIRST/LAST, ... );` \
Создание индекса с указанием порядка сортировки - `CREATE INDEX имя-индекса ON имя-таблицы ( имя-столбца DESC/ASC NULLS LAST, ... );` \
Удаление - `DROP INDEX имя-индекса;` \
P.S. Имя индекса можно опустить, тогда оно создается автоматически

**Автоматически индекс создается для:**
- PRIMARY KEY (Первичных ключей)
- UNIQUE constraints (Для значений, имеющих ограничение(constraint) как UNIQUE)

**Имя индекса состоит из:**
- имени таблицы и суффикса pkey (table_name_pkey) — для первичного ключа; 
- имени таблицы, имен столбцов, по которым создан индекс, и суффикса key (table_name_field_name_key)
— для уникального ключа.

**Полезные заметки**
- Индекс, созданный по столбцу, участвующему в соединении двух таблиц, 
может позволить ускорить процесс выборки записей из таблиц
- При выборке записей в отсортированном порядке индекс также может помочь, 
если сортировка выполняется по тем столбцам, по которым индекс создан
- _Селективность_ - выборка данных. _Низкая селективность_ - большое кол-во строк.
_Высокая селективность_ - небольшое кол-во строк.
- Если в SQL-запросе есть предложение ORDER BY, то индекс может позволить избежать 
этапа сортировки выбранных строк
- Однако если SQL-запрос просматривает значительную часть таблицы, то явная сортировка выбранных 
строк может оказаться быстрее, чем использование индекса
- Индексы более полезны, когда из таблицы выбирается лишь небольшая доля строк, 
т. е. при _высокой селективности_ выборки
- В случае использования предложения ORDER BY в комбинации 
с LIMIT n явная сортировка (при отсутствии индекса) потребует 
обработки всех строк таблицы ради того, чтобы определить первые n строк. 
Но если есть индекс по тем же столбцам, по которым производится сортировка ORDER BY,
то эти первые n строк могут быть извлечены непосредственно, без сканирования 
остальных строк вообще.
- По умолчанию при создании индекса NULL значения идут последними, 
т.к. применяется сортировка по возрастанию
- `NULLS FIRST` или `NULL LAST` - при создании индекса для определения порядка NULL значений 
(`CREATE INDEX имя-индекса ON имя-таблицы ( имя-столбца NULLS FIRST, ... );`)




## Команды psql:
`\d имя_таблицы` - все индексы данной таблицы